(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[423],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return c},kt:function(){return m}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(t),m=r,A=d["".concat(l,".").concat(m)]||d[m]||u[m]||i;return t?a.createElement(A,o(o({ref:n},c),{},{components:t})):a.createElement(A,o({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},2852:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return d}});var a=t(2122),r=t(9756),i=(t(7294),t(3905)),o=["components"],s={sidebar_position:2},l="\u4ea4\u6613\u7ed3\u6784",p={unversionedId:"documentation/everpay-tx",id:"documentation/everpay-tx",isDocsHomePage:!1,title:"\u4ea4\u6613\u7ed3\u6784",description:"everPay \u6709\u81ea\u5df1\u72ec\u7acb\u7684\u4ea4\u6613\u683c\u5f0f\uff0c\u6240\u6709\u7684 everPay \u4ea4\u6613\u90fd\u5c06\u5b58\u50a8\u5728 arweave \u533a\u5757\u94fe\u4e0a\uff0c\u4f9b\u6240\u6709\u4eba\u9a8c\u8bc1\u3002",source:"@site/docs/documentation/everpay-tx.md",sourceDirName:"documentation",slug:"/documentation/everpay-tx",permalink:"/docs/documentation/everpay-tx",editUrl:"https://github.com/everFinance/docs/edit/master/docs/documentation/everpay-tx.md",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"documentation",previous:{title:"\u8d26\u6237\u6a21\u578b",permalink:"/docs/documentation/account-model"},next:{title:"\u4ea4\u6613\u8bb0\u5f55",permalink:"/docs/documentation/everpay-transaction"}},c=[{value:"\u4ea4\u6613\u7b7e\u540d\u5185\u5bb9",id:"\u4ea4\u6613\u7b7e\u540d\u5185\u5bb9",children:[]},{value:"\u4ea4\u6613\u7b7e\u540d\u8be6\u7ec6\u5b57\u6bb5\u63cf\u8ff0",id:"\u4ea4\u6613\u7b7e\u540d\u8be6\u7ec6\u5b57\u6bb5\u63cf\u8ff0",children:[]},{value:"\u4e0d\u540c\u8d26\u6237\u6a21\u578b\u7684\u7b7e\u540d\u751f\u6210",id:"\u4e0d\u540c\u8d26\u6237\u6a21\u578b\u7684\u7b7e\u540d\u751f\u6210",children:[{value:"ethereum \u8d26\u6237\u6a21\u578b",id:"ethereum-\u8d26\u6237\u6a21\u578b",children:[]},{value:"arweave \u8d26\u6237\u6a21\u578b",id:"arweave-\u8d26\u6237\u6a21\u578b",children:[]}]},{value:"\u4ea4\u6613\u552f\u4e00\u6807\u8bc6\uff1aeverHash",id:"\u4ea4\u6613\u552f\u4e00\u6807\u8bc6\uff1aeverhash",children:[]}],u={toc:c};function d(e){var n=e.components,t=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u4ea4\u6613\u7ed3\u6784"},"\u4ea4\u6613\u7ed3\u6784"),(0,i.kt)("p",null,"everPay \u6709\u81ea\u5df1\u72ec\u7acb\u7684\u4ea4\u6613\u683c\u5f0f\uff0c\u6240\u6709\u7684 everPay \u4ea4\u6613\u90fd\u5c06\u5b58\u50a8\u5728 arweave \u533a\u5757\u94fe\u4e0a\uff0c\u4f9b\u6240\u6709\u4eba\u9a8c\u8bc1\u3002"),(0,i.kt)("p",null,"everPay \u7684\u6bcf\u4e00\u7b14\u4ea4\u6613\u90fd\u4ee5\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6\uff1aeverHash\u3002"),(0,i.kt)("p",null,"\u76ee\u524d everPay \u6709\u4e09\u4e2a\u7c7b\u578b\u7684\u4ea4\u6613\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5145\u503c\uff1a\u7ecf\u8fc7\u7528\u6237\u5145\u503c\u7684\u533a\u5757\u94fe\u4ea4\u6613\u8bb0\u5f55\u786e\u8ba4\u76f8\u5e94\u533a\u5757\u540e\uff0cbot \u4f1a\u751f\u6210\u4e00\u7b14 ",(0,i.kt)("inlineCode",{parentName:"li"},"'mint'")," \u7684\u4ea4\u6613\u5b58\u50a8\u5728 arweave \u4e0a"),(0,i.kt)("li",{parentName:"ul"},"\u8f6c\u8d26\uff1a\u7528\u6237\u7b7e\u540d\u7684\u8f6c\u8d26\u4ea4\u6613\uff0c\u5c06 Token \u4f59\u989d\u8f6c\u79fb\u5230\u6536\u6b3e\u4eba\u8d26\u6237"),(0,i.kt)("li",{parentName:"ul"},"\u63d0\u73b0\uff1a\u7528\u6237\u7b7e\u540d\u7684\u63d0\u73b0\u4ea4\u6613\uff0c\u4ea4\u6613\u4f1a\u88ab everPay \u7684 DAO \u6210\u5458\u8fdb\u884c\u9a8c\u8bc1\uff0c\u901a\u8fc7 DAO \u63d0\u4ea4\u63d0\u73b0\u63d0\u6848\uff0c\u5e76\u5728\u4ee5\u592a\u574a\u6216\u8005 Arweave \u8fdb\u884c\u63d0\u73b0\u6267\u884c")),(0,i.kt)("h2",{id:"\u4ea4\u6613\u7b7e\u540d\u5185\u5bb9"},"\u4ea4\u6613\u7b7e\u540d\u5185\u5bb9"),(0,i.kt)("p",null,"\u4e0d\u7ba1\u662f\u4ee5\u592a\u574a PersonalSign \u8fd8\u662f Arweava \u7684 RSS \u7b7e\u540d\uff0c\u7b7e\u7f72\u7684\u4ea4\u6613\u5747\u4f7f\u7528\u76f8\u540c\u7684\u7b7e\u540d\u89c4\u8303\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"export const getEverpayTxMessage = (everpayTxWithoutSig: EverpayTxWithoutSig): string => {\n  const keys = [\n    'tokenSymbol',\n    'action',\n    'from',\n    'to',\n    'amount',\n    'fee',\n    'feeRecipient',\n    'nonce',\n    'tokenID',\n    'chainType',\n    'chainID',\n    'data',\n    'version'\n  ] as const\n  return keys.map(key => `${key}:${everpayTxWithoutSig[key]}`).join('\\n')\n}\n")),(0,i.kt)("p",null,"\u5176\u4e2d EverpayTxWithoutSig \u53ef\u53c2\u8003 ",(0,i.kt)("a",{parentName:"p",href:"./everpay-js/types#everpaytxwithoutsig"},"everpay-js types#EverpayTxWithoutSig")),(0,i.kt)("h2",{id:"\u4ea4\u6613\u7b7e\u540d\u8be6\u7ec6\u5b57\u6bb5\u63cf\u8ff0"},"\u4ea4\u6613\u7b7e\u540d\u8be6\u7ec6\u5b57\u6bb5\u63cf\u8ff0"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"\u5b57\u6bb5"),(0,i.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"tokenSymbol"),(0,i.kt)("td",{parentName:"tr",align:null},"\u4ee3\u5e01\u540d\u79f0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"action"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"'mint'"),"\u4ee3\u8868\u5145\u503c\uff1b",(0,i.kt)("inlineCode",{parentName:"td"},"'transfer'"),"\u4ee3\u8868\u8f6c\u8d26\uff1b",(0,i.kt)("inlineCode",{parentName:"td"},"'burn'"),"\u4ee3\u8868\u63d0\u73b0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"from"),(0,i.kt)("td",{parentName:"tr",align:null},"\u7b7e\u7f72\u4ea4\u6613\u7684\u5f53\u524d everPay \u8d26\u6237 ID")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"to"),(0,i.kt)("td",{parentName:"tr",align:null},"\u8f6c\u8d26\u65f6\uff0c",(0,i.kt)("inlineCode",{parentName:"td"},"to")," \u4e3a\u53e6\u4e00\u4e2a everPay \u8d26\u6237 ID\uff1b\u63d0\u73b0\u65f6\uff0c",(0,i.kt)("inlineCode",{parentName:"td"},"to")," \u4e3a\u8981\u63d0\u73b0\u81f3\u7684\u533a\u5757\u94fe\u94b1\u5305\u5730\u5740")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"amount"),(0,i.kt)("td",{parentName:"tr",align:null},"\u8f6c\u8d26\u91d1\u989d\u6216\u63d0\u73b0\u91d1\u989d\uff0c\u7c7b\u578b\u4e3a uint\u3002\u8bbe\u7f6e\u65f6\u9700\u8981\u8fdb\u884c ",(0,i.kt)("inlineCode",{parentName:"td"},"decimals")," \u5904\u7406\uff0c\u4f8b\u5982 0.1USDT\uff0c\u6b64\u5904\u7ecf\u8fc7 USDT \u7684 ",(0,i.kt)("inlineCode",{parentName:"td"},"decimals: 6")," \u5904\u7406\u540e\uff0c\u4e3a 100000")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"fee"),(0,i.kt)("td",{parentName:"tr",align:null},"\u624b\u7eed\u8d39\uff0c\u7c7b\u578b\u4e3a uint\u3002\u9700\u8981\u8fdb\u884c decimals \u5904\u7406\uff0c\u4f8b\u5982 0.1USDT\uff0c\u6b64\u5904\u7ecf\u8fc7 USDT \u7684 ",(0,i.kt)("inlineCode",{parentName:"td"},"decimals: 6")," \u5904\u7406\u540e\uff0c\u4e3a 100000")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"feeRecipient"),(0,i.kt)("td",{parentName:"tr",align:null},"\u624b\u7eed\u8d39\u6536\u6b3e\u5730\u5740\uff0c\u901a\u8fc7 ",(0,i.kt)("a",{parentName:"td",href:"./server-api/basic-api/info"},"everpay server info API")," \u63a5\u53e3\u83b7\u53d6")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"nonce"),(0,i.kt)("td",{parentName:"tr",align:null},"unix milliseconds\uff0cunix \u6beb\u79d2\u65f6\u95f4\u6233")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"tokenID"),(0,i.kt)("td",{parentName:"tr",align:null},"\u901a\u8fc7 ",(0,i.kt)("a",{parentName:"td",href:"./server-api/basic-api/info"},"everpay server info API")," \u63a5\u53e3\u83b7\u53d6\uff0c\u5fc5\u987b\u4e0e ",(0,i.kt)("inlineCode",{parentName:"td"},"tokenSymbol")," \u5bf9\u5e94\u7684 token id \u5339\u914d")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"data"),(0,i.kt)("td",{parentName:"tr",align:null},"\u8f6c\u8d26\u9644\u52a0\u4fe1\u606f\uff0c\u7528\u6237\u53ef\u81ea\u5b9a\u4e49JSON \u6570\u636e\uff0c\u7ecf\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"td"},"JSON.stringify()")," \u5904\u7406\u540e\u4f20\u9012\u3002",(0,i.kt)("strong",{parentName:"td"},"\u5f53\u5f53\u524d\u8d26\u6237\u662f arweave \u8d26\u6237\u6a21\u578b\u65f6\uff0c\u9700\u8981\u4f20\u9012",(0,i.kt)("inlineCode",{parentName:"strong"},'{"arOwner": "current arweave address\'s owner(public key)"}')),"\uff0c\u7528\u4e8e RSA-PSS sha256 \u9a8c\u8bc1")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"version"),(0,i.kt)("td",{parentName:"tr",align:null},"\u4ea4\u6613\u7248\u672c ",(0,i.kt)("inlineCode",{parentName:"td"},"'v1'"))))),(0,i.kt)("h2",{id:"\u4e0d\u540c\u8d26\u6237\u6a21\u578b\u7684\u7b7e\u540d\u751f\u6210"},"\u4e0d\u540c\u8d26\u6237\u6a21\u578b\u7684\u7b7e\u540d\u751f\u6210"),(0,i.kt)("h3",{id:"ethereum-\u8d26\u6237\u6a21\u578b"},"ethereum \u8d26\u6237\u6a21\u578b"),(0,i.kt)("p",null,"\u901a\u8fc7 ethereum personalSign \u7b7e\u540d"),(0,i.kt)("h4",{id:"\u901a\u8fc7-ethersjs-\u751f\u6210\u7b7e\u540d\u4e0e-everpay-tx"},"\u901a\u8fc7 ethers.js \u751f\u6210\u7b7e\u540d\u4e0e everPay Tx"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"const everpayTxWithoutSig = {\n  tokenSymbol: 'usdt',\n  action: 'transfer',\n  from: '0x26361130d5d6E798E9319114643AF8c868412859',\n  to: '5NPqYBdIsIpJzPeYixuz7BEH_W7BEk_mb8HxBD3OHXo',\n  amount: '5260000',\n  fee: '0',\n  feeRecipient: '0x6451eB7f668de69Fb4C943Db72bCF2A73DeeC6B1',\n  nonce: '1626079771946',\n  tokenID: '0xd85476c906b5301e8e9eb58d174a6f96b9dfc5ee',\n  chainType: 'ethereum',\n  chainID: '42',\n  data: '{\"hello\":\"world\",\"this\":\"is everpay\"}',\n  version: 'v1'\n}\n\n// const message = getEverpayTxMessage(everpayTxWithoutSig)\nconst message = `tokenSymbol:usdt\naction:transfer\nfrom:0x26361130d5d6E798E9319114643AF8c868412859\nto:5NPqYBdIsIpJzPeYixuz7BEH_W7BEk_mb8HxBD3OHXo\namount:5260000\nfee:0\nfeeRecipient:0x6451eB7f668de69Fb4C943Db72bCF2A73DeeC6B1\nnonce:1626079771946\ntokenID:0xd85476c906b5301e8e9eb58d174a6f96b9dfc5ee\nchainType:ethereum\nchainID:42\ndata:{\"hello\":\"world\",\"this\":\"is everpay\"}\nversion:v1`\n\n// personalSign\nconst signMessageAsync = async (ethConnectedSigner: Signer, message: string): Promise<string> => {\n  return await ethConnectedSigner.signMessage(message)\n}\n\nconst sig = await signMessageAsync(ethConnectedSigner, message)\nconst everPayTx = {\n  ...everpayTxWithoutSig,\n  sig\n}\n")),(0,i.kt)("p",null,"\u4f2a\u4ee3\u7801\u53c2\u8003\u6765\u6e90\uff1a",(0,i.kt)("a",{parentName:"p",href:"https://github.com/everFinance/everpay-js/blob/main/src/lib/sign.ts"},"everpay-js src/lib/sign.ts")),(0,i.kt)("h3",{id:"arweave-\u8d26\u6237\u6a21\u578b"},"arweave \u8d26\u6237\u6a21\u578b"),(0,i.kt)("p",null,"\u901a\u8fc7 arweave RSA-PSS sha256 \u7b7e\u540d"),(0,i.kt)("h4",{id:"\u901a\u8fc7-arweavejs-\u751f\u6210\u7b7e\u540d\u4e0e-everpay-tx"},"\u901a\u8fc7 arweave.js \u751f\u6210\u7b7e\u540d\u4e0e everPay Tx"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"const everpayTxWithoutSig = {\n  tokenSymbol: 'ar',\n  action: 'transfer',\n  from: '5NPqYBdIsIpJzPeYixuz7BEH_W7BEk_mb8HxBD3OHXo',\n  to: '0x26361130d5d6E798E9319114643AF8c868412859',\n  amount: '100',\n  fee: '0',\n  feeRecipient: '0x6451eB7f668de69Fb4C943Db72bCF2A73DeeC6B1',\n  nonce: '1626080392301',\n  tokenID: 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,0xcc9141efa8c20c7df0778748255b1487957811be',\n  chainType: 'arweave,ethereum',\n  chainID: '0,42',\n  data: '{\"hello\":\"world\",\"this\":\"is everpay\",\"arOwner\":\"odtNk97a4PARR0I8g3kQpzlFVmPg-udyjfl81fbTioyP2pEw5tP5A1-FVqR-QFFPskW-j7yAze5usYNWHEir7oVQ9d9bbkcZIDEPqwSTO1JoD1BKXeeBK0xsmiSgxeY7uuRXWdhXREhlmIMsV8ObakEeXdbbxbs89XaZHBuES7boASrRVDXRz_mhMu6u_58OdLeMwR3I1BCH6nphNGVOehA7GOOqEBvtesBset0bNaLCb0JpSg5ZW_0AGLP-XydzE3IPLLx4NQEEJY21y8fChxYM4jntI78l5hojp9NlmS69EXlj0PoMjsbaWaz9WtnZaMAbnaOGAHhv8Y_TNmBI0FHpqHaGPP906Mnrgdm3tl2L40EX-Q6-liNVkB56CmPxXzSesu-4x5LLYxQ-aX3W6Hj7RCDTacxqUJHzOrhJqXSx6Jx0t8CwyfReMgVv4p5t1C3OZ8yYbJ_H3LdkeriVniaC5jQdMyIJ6QBMzr1XdXIw9WuEG2kCIYtvOp2qDuu9o2SY-9W4Yv7VWRDfWO38xxR4ZO65MMAdZxeaZ4w8sK_owH46Wm0XoT3Al-LPypaeijWqlHEu4R8c2ersD3xkDvXC_lNtaQw_qyfI3UEH5fWupY4zhZeDGkvXQh32Fv4CxlZL58iUHv9SvR7p5LgBCC3AVUbn7Sqc4xPUCZMj-Tc\"}',\n  version: 'v1'\n}\n\n// const message = getEverpayTxMessage(everpayTxWithoutSig)\nconst message = `tokenSymbol:ar\naction:transfer\nfrom:5NPqYBdIsIpJzPeYixuz7BEH_W7BEk_mb8HxBD3OHXo\nto:0x26361130d5d6E798E9319114643AF8c868412859\namount:100\nfee:0\nfeeRecipient:0x6451eB7f668de69Fb4C943Db72bCF2A73DeeC6B1\nnonce:1626080392301\ntokenID:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,0xcc9141efa8c20c7df0778748255b1487957811be\nchainType:arweave,ethereum\nchainID:0,42\ndata:{\"hello\":\"world\",\"this\":\"is everpay\",\"arOwner\":\"odtNk97a4PARR0I8g3kQpzlFVmPg-udyjfl81fbTioyP2pEw5tP5A1-FVqR-QFFPskW-j7yAze5usYNWHEir7oVQ9d9bbkcZIDEPqwSTO1JoD1BKXeeBK0xsmiSgxeY7uuRXWdhXREhlmIMsV8ObakEeXdbbxbs89XaZHBuES7boASrRVDXRz_mhMu6u_58OdLeMwR3I1BCH6nphNGVOehA7GOOqEBvtesBset0bNaLCb0JpSg5ZW_0AGLP-XydzE3IPLLx4NQEEJY21y8fChxYM4jntI78l5hojp9NlmS69EXlj0PoMjsbaWaz9WtnZaMAbnaOGAHhv8Y_TNmBI0FHpqHaGPP906Mnrgdm3tl2L40EX-Q6-liNVkB56CmPxXzSesu-4x5LLYxQ-aX3W6Hj7RCDTacxqUJHzOrhJqXSx6Jx0t8CwyfReMgVv4p5t1C3OZ8yYbJ_H3LdkeriVniaC5jQdMyIJ6QBMzr1XdXIw9WuEG2kCIYtvOp2qDuu9o2SY-9W4Yv7VWRDfWO38xxR4ZO65MMAdZxeaZ4w8sK_owH46Wm0XoT3Al-LPypaeijWqlHEu4R8c2ersD3xkDvXC_lNtaQw_qyfI3UEH5fWupY4zhZeDGkvXQh32Fv4CxlZL58iUHv9SvR7p5LgBCC3AVUbn7Sqc4xPUCZMj-Tc\"}\nversion:v1`\n\n// RSA-PSS sha256\nconst signMessageAsync = async (arJWK: ArJWK, personalMsgHash: Buffer): Promise<string> => {\n  const arweave = Arweave.init(options)\n  // web\n  if (arJWK === 'use_wallet') {\n    try {\n      await checkArPermissions('SIGNATURE')\n    } catch {\n      throw new Error(ERRORS.SIGNATURE_PERMISSION_NEEDED)\n    }\n\n    const algorithm = {\n      name: 'RSA-PSS',\n      saltLength: 32\n    }\n\n    try {\n      // TODO: wait arweave-js update arconnect.d.ts\n      const signature = await (window.arweaveWallet as any).signature(\n        personalMsgHash,\n        algorithm\n      )\n      const buf = new Uint8Array(Object.values(signature))\n      return Arweave.utils.bufferTob64Url(buf)\n    } catch {\n      throw new Error(ERRORS.SIGNATURE_FAILED)\n    }\n\n  // node\n  } else {\n    const buf = await arweave.crypto.sign(arJWK, personalMsgHash)\n    return Arweave.utils.bufferTob64Url(buf)\n  }\n}\n\n// cp from: https://github.com/ethereumjs/ethereumjs-util/blob/ebf40a0fba8b00ba9acae58405bca4415e383a0d/src/signature.ts#L168\nconst hashPersonalMessage = function (message: Buffer): Buffer {\n  const prefix = Buffer.from(\n    `\\u0019Ethereum Signed Message:\\n${message.length.toString()}`,\n    'utf-8'\n  )\n  return keccak256(Buffer.concat([prefix, message]))\n}\n\nconst personalMsgHash = hashPersonalMessage(Buffer.from(message))\n\nconst sig = await signMessageAsync(config.arJWK as ArJWK, personalMsgHash)\nconst everPayTx = {\n  ...everpayTxWithoutSig,\n  sig\n}\n")),(0,i.kt)("p",null,"\u4f2a\u4ee3\u7801\u53c2\u8003\u6765\u6e90\uff1a",(0,i.kt)("a",{parentName:"p",href:"https://github.com/everFinance/everpay-js/blob/main/src/lib/sign.ts"},"everpay-js src/lib/sign.ts")),(0,i.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"arweave \u7528\u4e8e RSA-PSS sha256 \u7b7e\u540d\u7684 message\uff0c\u9700\u8981\u7ecf\u8fc7 Ethereum ",(0,i.kt)("inlineCode",{parentName:"p"},"hashPersonalMessage")," \u5904\u7406\uff0c\u6765\u7edf\u4e00 everPay \u540e\u7aef\u670d\u52a1\u7684\u9a8c\u8bc1\u89c4\u8303\u3002"))),(0,i.kt)("h2",{id:"\u4ea4\u6613\u552f\u4e00\u6807\u8bc6\uff1aeverhash"},"\u4ea4\u6613\u552f\u4e00\u6807\u8bc6\uff1aeverHash"),(0,i.kt)("p",null,"\u6bcf\u4e00\u7b14 everPay Tx \u4ea4\u6613\u7684 everHash \u90fd\u662f\u552f\u4e00\u7684\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"everHash")," \u7684\u751f\u6210\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},'// cp from: https://github.com/ethereumjs/ethereumjs-util/blob/ebf40a0fba8b00ba9acae58405bca4415e383a0d/src/signature.ts#L168\nconst hashPersonalMessage = function (message: Buffer): Buffer {\n  const prefix = Buffer.from(\n    `\\u0019Ethereum Signed Message:\\n${message.length.toString()}`,\n    \'utf-8\'\n  )\n  return keccak256(Buffer.concat([prefix, message]))\n}\n\nconst message = `tokenSymbol:ar\naction:transfer\nfrom:5NPqYBdIsIpJzPeYixuz7BEH_W7BEk_mb8HxBD3OHXo\nto:0x26361130d5d6E798E9319114643AF8c868412859\namount:100\nfee:0\nfeeRecipient:0x6451eB7f668de69Fb4C943Db72bCF2A73DeeC6B1\nnonce:1626080392301\ntokenID:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,0xcc9141efa8c20c7df0778748255b1487957811be\nchainType:arweave,ethereum\nchainID:0,42\ndata:{"hello":"world","this":"is everpay","arOwner":"odtNk97a4PARR0I8g3kQpzlFVmPg-udyjfl81fbTioyP2pEw5tP5A1-FVqR-QFFPskW-j7yAze5usYNWHEir7oVQ9d9bbkcZIDEPqwSTO1JoD1BKXeeBK0xsmiSgxeY7uuRXWdhXREhlmIMsV8ObakEeXdbbxbs89XaZHBuES7boASrRVDXRz_mhMu6u_58OdLeMwR3I1BCH6nphNGVOehA7GOOqEBvtesBset0bNaLCb0JpSg5ZW_0AGLP-XydzE3IPLLx4NQEEJY21y8fChxYM4jntI78l5hojp9NlmS69EXlj0PoMjsbaWaz9WtnZaMAbnaOGAHhv8Y_TNmBI0FHpqHaGPP906Mnrgdm3tl2L40EX-Q6-liNVkB56CmPxXzSesu-4x5LLYxQ-aX3W6Hj7RCDTacxqUJHzOrhJqXSx6Jx0t8CwyfReMgVv4p5t1C3OZ8yYbJ_H3LdkeriVniaC5jQdMyIJ6QBMzr1XdXIw9WuEG2kCIYtvOp2qDuu9o2SY-9W4Yv7VWRDfWO38xxR4ZO65MMAdZxeaZ4w8sK_owH46Wm0XoT3Al-LPypaeijWqlHEu4R8c2ersD3xkDvXC_lNtaQw_qyfI3UEH5fWupY4zhZeDGkvXQh32Fv4CxlZL58iUHv9SvR7p5LgBCC3AVUbn7Sqc4xPUCZMj-Tc"}\nversion:v1`\nconst personalMsgHash = hashPersonalMessage(Buffer.from(message))\nconst everHash = `0x${personalMsgHash.toString(\'hex\')}`\n')))}d.isMDXComponent=!0}}]);